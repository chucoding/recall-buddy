---
description: Notion MCP 사용법 및 페이지 작성 시 포맷·다이어그램 규칙
alwaysApply: false
---

# Notion 규칙

**user-Notion** MCP로 페이지를 읽거나 수정할 때 아래 순서와 작성 규칙을 따른다.

## 1. 페이지 읽기 (필수 선행)

- **도구**: `notion-fetch` (서버: `user-Notion`)
- **인자**: `id` — Notion 페이지 URL 또는 UUID
  - 예: `https://www.notion.so/chucoding/ui-ux-pro-30bfd64d44a080cbae71d13770f2fb4a`
  - 예: `30bfd64d44a080cbae71d13770f2fb4a`
- **결과**: `metadata`, `title`, `url`, `text`(본문). 본문은 Notion-flavored Markdown + XML 태그(`<page>`, `<table>`, `<content>` 등) 형태로 반환된다.
- **읽기 실패 시**: URL이 잘못되었거나, 해당 페이지에 대한 접근 권한이 없을 수 있다. 사용자에게 "Notion URL 확인 및 공유 설정(연동 계정 접근 허용)"을 안내한다.

## 2. 페이지 수정

- **도구**: `notion-update-page` (서버: `user-Notion`)
- **인자**: `data` 객체
  - `page_id`: 필수. fetch로 얻은 URL 또는 UUID(대시 유무 무관).
  - `command`: `update_properties` | `replace_content` | `replace_content_range` | `insert_content_after`
  - **내용 추가**: `command: "insert_content_after"`, `selection_with_ellipsis`(고유한 앞~10자...뒤~10자), `new_str`(추가할 문자열)
  - **일부 교체**: `command: "replace_content_range"`, `selection_with_ellipsis`, `new_str`
  - **전체 교체**: `command: "replace_content"`, `new_str` (자식 페이지/DB가 있으면 실패할 수 있음)

## 3. Notion-flavored Markdown

- **스펙 확인**: 리소스 `notion://docs/enhanced-markdown-spec`을 `fetch_mcp_resource`로 가져와 문법 확인.
- **테이블**: `<table header-row="true">` + `<tr>`, `<td>` 사용. 셀 안에는 리치 텍스트만(**bold**, `code` 등).
- **특수문자 이스케이프**: `\ * ~ \` $ [ ] < > { } | ^` 는 문맥에 따라 `\` 로 이스케이프. 코드 블록 안은 리터럴.
- **구분선**: `---`

## 4. 작성 포맷 (Notion 페이지에 쓸 때)

- 한국어로 작성한다.
- 섹션은 `#` 헤딩으로 구분하고, 비교/정리에는 테이블을 사용한다.
- 코드 스니펫은 언어 태그를 포함한 코드 블록으로 작성한다.
- 설계 문서, 아키텍처 설명, 데이터 흐름 등을 정리할 때 **Mermaid 다이어그램을 적극 활용**한다.
  - 컴포넌트/모듈 간 의존 관계
  - 데이터 흐름 (API 호출, 번들 분리 등)
  - 시퀀스 다이어그램 (사용자 플로우)
  - 아키텍처 결정 비교

## 5. 문제 파악 체크리스트

| 증상 | 확인 사항 |
|------|-----------|
| fetch 시 에러/빈 결과 | 1) URL 또는 page id 정확한지 2) Notion 연동 계정이 해당 페이지 접근 가능한지 3) MCP 서버(user-Notion) 실행 여부 |
| update 시 에러 | 1) `page_id`가 fetch 결과의 url과 일치하는지 2) `selection_with_ellipsis`가 본문에 유일하게 매칭되는지(앞·뒤 10자 정도로 고유하게) 3) `new_str`이 Enhanced Markdown 스펙에 맞는지 |
| 테이블/서식 깨짐 | Enhanced Markdown 스펙에서 테이블·리스트 문법 재확인, 이스케이프 필요 문자 처리 |

## 6. 참고

- **MCP 도구 스키마**: 워크스페이스 `.cursor/projects/.../mcps/user-Notion/tools/*.json` 에서 인자·필수값 확인.
